; This file is auto-generated. Do not edit manually: changes may be erased.
; Generated by Aqua compiler: https://github.com/fluencelabs/aqua/.
; If you find any bugs, please write an issue on GitHub: https://github.com/fluencelabs/aqua/issues
; Aqua version: 0.7.3-319

(xor
 (xor
  (seq
   (seq
    (call %init_peer_id% ("peer" "timestamp_sec") [] t)
    (call %init_peer_id% ("registry" "evict_stale") [t] res)
   )
   (par
    (fold res.$.results! r-0
     (par
      (seq
       (seq
        (call %init_peer_id% ("op" "string_to_b58") [r-0.$.key.id!] k)
        (call %init_peer_id% ("kad" "neighborhood") [k [] []] nodes)
       )
       (par
        (fold nodes n-0
         (par
          (new $records_weights
           (xor
            (seq
             (seq
              (seq
               (seq
                (call n-0 ("peer" "timestamp_sec") [] tt)
                (call n-0 ("trust-graph" "get_weight") [r-0.$.key.owner_peer_id! tt] key_weight)
               )
               (call n-0 ("registry" "republish_key") [r-0.$.key! key_weight tt])
              )
              (fold r-0.$.records! record-0
               (seq
                (call n-0 ("trust-graph" "get_weight") [record-0.$.peer_id! tt] $records_weights)
                (next record-0)
               )
              )
             )
             (call n-0 ("registry" "republish_records") [r-0.$.records! $records_weights tt])
            )
            (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 1])
           )
          )
          (next n-0)
         )
        )
        (null)
       )
      )
      (next r-0)
     )
    )
    (null)
   )
  )
  (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 2])
 )
 (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 3])
)
