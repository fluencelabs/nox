## VM benchmark tests

This benchmark consists of seven tests that we used for perfomance tests of various Webassembly compiler and interpreter type virtual machines. Each test exports one function with name `main` (`main` because of `wasmer` doesn't support any other export function names) that should be called to bench. Also there are a few compile-time parameters in each test that can be adjusted on compilation by corresponding env variables (on the following part of readme upper-case naming will be used to mar them).

### Compression

This test compresses sequence of SEQUENCE_SIZE bytes randomly generated by IsaacRng in series. There are ITERATIONS_COUNT iterations of compressions. On each iteration a new sequence is generated by seed that computed based on previously sequence. And as the first seed SEED parameter is used. Also there are two supported compression algorithms (deflate and snappy) that are chosen by "deflate_compression" feature.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

SEED=<seed> ITERATIONS_COUNT=<iterations count> SEQUENCE_SIZE=<sequence size> cargo +nightly build --release --target wasm32-unknown-unknown [--feature "deflate_compression"]
```

### Factorization

This test simply factorizes given FACTORIZED_NUMBER by sieves from reikna library.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

FACTORIZED_NUMBER=<number to factorize> cargo build --release --target wasm32-unknown-unknown
```

### Recursive fibonacci computing

This test simply computes a given fibonacci number recursively.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

FIB_NUMBER=<fibonacci number> cargo build --release --target wasm32-unknown-unknown
```

### Matrix product

This test computes QR decomposition of randomly generated by IsaacRng square matrices of MATRIX_SIZE. There are ITERATIONS_COUNT iterations of decompositions. On each iteration a new matrices is generated by seed that computed as a xor of singular values of previously matrix decomposition result. And as the first seed SEED parameter is used.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

ITERATIONS_COUNT=<iterations_count> INITIAL_VALUE=<initial_value> cargo build --release --target wasm32-unknown-unknown
```

### Matrix QR decomposition

This test computes QR decomposition of randomly generated by IsaacRng square matrices of MATRIX_SIZE. There are ITERATIONS_COUNT iterations of decompositions. On each iteration a new matrices is generated by seed that computed as a trace of previously matrix product result. And as the first seed SEED parameter is used.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

ITERATIONS_COUNT=<iterations_count> INITIAL_VALUE=<initial_value> cargo build --release --target wasm32-unknown-unknown
```

### Matrix SVD decomposition

This test computes SVD decomposition of randomly generated by IsaacRng square matrices of MATRIX_SIZE. There are ITERATIONS_COUNT iterations of decompositions. On each iteration a new matrices is generated by seed that computed as a xor of singular values of previously matrix decomposition result. And as the first seed SEED parameter is used.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

ITERATIONS_COUNT=<iterations_count> INITIAL_VALUE=<initial_value> cargo build --release --target wasm32-unknown-unknown
```

### Recursive hash computing

This test computes a sequence of hashes `f(f(...f(initial_value))` ITERATIONS_COUNT times. As an initial value INITIAL_VALUE is used.

To build this test on Linux/MacOS OS please use the following commands:

```shell
git clone --recursive https://github.com/fluencelabs/fluence

cd fluence/vm/vm_bench/tests/recursive_hash

ITERATIONS_COUNT=<iterations count> INITIAL_VALUE=<initial value> cargo +nightly build --release --target wasm32-unknown-unknown
```
