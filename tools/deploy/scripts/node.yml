version: '3.4'

services:
  fluence-node-1:
    container_name: $NAME
    image: fluencelabs/node:$IMAGE_TAG
    environment:
      - TENDERMINT_IP=$DOCKER_IP
      - ETHEREUM_IP=$ETHEREUM_IP
      - SWARM_ADDRESS=$SWARM_ADDRESS
      - SWARM_HOST=$SWARM_ADDRESS # TODO: remove SWARM_HOST (replaced by SWARM_ADDRESS)
      - CONTRACT_ADDRESS=$CONTRACT_ADDRESS
      - OWNER_ADDRESS=$OWNER_ADDRESS
      - WORKER_MEMORY_LIMIT=200 # megabytes
      - WORKER_TAG=$IMAGE_TAG
    ports:
      # API port
      - $API_PORT:5678
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - $FLUENCE_STORAGE:/master
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 200M
        reservations:
          memory: 150M
